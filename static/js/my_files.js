// Generated by CoffeeScript 1.6.3
(function() {
  $(function() {
    var currentFilename, edit, remove;
    currentFilename = '';
    edit = function() {
      var fname, vlink;
      vlink = $(this).parent().children('.videolink');
      fname = vlink.html();
      if (fname.substring(0, 6) !== "<input") {
        currentFilename = fname;
        return vlink.html('<input type="text" id="rbox" autofocus="true" placeholder="' + fname + '">');
      }
    };
    $('.editbutton').click(edit);
    $(document).on('keypress', 'input', function(event) {
      var $target;
      if (event.which === 13 || event.keycode === 13) {
        $target = $(this).parent();
        $.ajax({
          url: 'change_name/',
          type: 'POST',
          dataType: 'json',
          data: {
            'filename': currentFilename,
            'newname': this.value
          },
          success: function(json) {
            return $target.html(json.response);
          },
          error: function(xhr, json) {
            return alert(xhr.status + '. Info: ' + json.error);
          }
        });
        return event.preventDefault();
      }
    });
    remove = function() {
      var fname, target;
      target = $(this).parent();
      fname = target.children('.videolink').html();
      target.remove();
      return $.ajax({
        url: 'remove_resource/',
        type: 'POST',
        dataType: 'json',
        data: {
          'filename': fname
        },
        success: function(json) {
          return $('#result').append('<li>' + json.response + '</li>');
        },
        error: function(xhr, json) {
          return alert(xhr.status + '. Info: ' + json.error);
        }
      });
    };
    $('.removebutton').click(remove);
    return $('.videolink').on('click', function() {
      var clicked, myVideo;
      clicked = $(event.target);
      myVideo = document.getElementById('video');
      $(myVideo).attr('poster', '/static/media/' + clicked.attr('id') + '.png');
      myVideo.src = '/static/media/' + clicked.attr('id') + '.webm';
      return myVideo.load();
    });
  });

}).call(this);
