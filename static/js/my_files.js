// Generated by CoffeeScript 1.6.3
(function() {
  $(function() {
    var currentFilename, edit, load_resources, remove, resources;
    resources = [];
    load_resources = function() {
      return $('#resourcelist > li').each(function() {
        var parsed;
        parsed = $(this).children('div').html().split('#');
        return resources.push(parsed[1]);
      });
    };
    load_resources();
    $('.btn-group > .btn').click(function() {
      var toggle;
      toggle = 'btn-primary';
      if ($(this).hasClass(toggle)) {
        $(this).removeClass(toggle);
        if ($(this).attr('id') === 'created_btn') {
          return $('.created_resource').hide();
        } else {
          return $('.shared_resource').hide();
        }
      } else {
        $(this).addClass(toggle);
        if ($(this).attr('id') === 'created_btn') {
          return $('.created_resource').show();
        } else {
          return $('.shared_resource').show();
        }
      }
    });
    currentFilename = '';
    edit = function() {
      var fname, vlink;
      vlink = $(this).parent().children('.videolink');
      fname = vlink.html();
      if (fname.substring(0, 6) !== "<input") {
        currentFilename = fname;
        return vlink.html('<input type="text" class="editbox" autofocus="true" placeholder="' + fname + '">');
      }
    };
    $('.editbutton').click(edit);
    $(document).on('keypress', '.editbox', function(event) {
      var $target;
      if (event.which === 13 || event.keycode === 13) {
        $target = $(this).parent();
        $.ajax({
          url: 'change_name/',
          type: 'POST',
          dataType: 'json',
          data: {
            'filename': currentFilename,
            'newname': this.value
          },
          success: function(json) {
            return $target.html(json.response);
          },
          error: function(xhr, json) {
            return alert(xhr.status + '. Info: ' + json.error);
          }
        });
        return event.preventDefault();
      }
    });
    remove = function() {
      var fname, target;
      target = $(this).parent();
      fname = target.children('.videolink').html();
      target.parent().parent().remove();
      return $.ajax({
        url: 'remove_resource/',
        type: 'POST',
        dataType: 'json',
        data: {
          'filename': fname
        },
        success: function(json) {
          return $('#result').append('<li>' + json.response + '</li>');
        },
        error: function(xhr, json) {
          return alert(xhr.status + '. Info: ' + json.error);
        }
      });
    };
    $('.removebutton').click(remove);
    return $('.videolink').on('click', function() {
      var clicked, myVideo;
      clicked = $(event.target);
      myVideo = document.getElementById('video');
      $(myVideo).attr('poster', '/static/media/' + clicked.attr('id') + '.png');
      myVideo.src = '/static/media/' + clicked.attr('id') + '.webm';
      return myVideo.load();
    });
  });

}).call(this);
